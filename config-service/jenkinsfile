final ARTIFACT = "config-service"
final DOCKER_IMAGE = "mrjeff/$ARTIFACT";

node {

		environment {
			maven 'maven 3.5.0'
			docker 'docker'
		}

        stage('Checkout') {

            git url: 'https://github.com/siwar-benrejeb/mrjeffapp.git', credentialsId:  'git-credit-ID', branch: 'master'

        }

        stage('Build') {
		dir ('config-service') {	
			def mvnHome = tool 'maven 3.5.0'
			env.PATH = "${mvnHome}/bin:${env.PATH}"
            sh 'mvn clean package'
		}
        }

        stage('Image') {


        sh "docker tag $DOCKER_IMAGE:latest $DOCKER_REMOTE_IMAGE:latest"

     

        }

        stage ('Run') {
		
			 dir ('config-service') {
			 
				def dock = tool 'docker'
				env.PATH = "${dock}/bin:${env.PATH}"
            docker.image("mrjeffapp_configservice").run('-p 8888:8888 --net=host --expose=8888 -t mrjeffapp_configservice:latest')
			}

        }
         stage ('Final') {

                    build job: 'eureka-service-Pipeline', wait: false

                }


}